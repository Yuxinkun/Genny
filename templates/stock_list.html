{% extends "mybase.html" %}
{% load static %}
{% load staticfiles %}
{% block title %}Welcome Stock Trading System{% endblock %}

{% block content %}

    <section class="content-header">

    </section>

    <section class="content">
        <div class="box">
            <div class="box-header">
                <h3 class="box-title">Stock Information List</h3>
                <div class="box-header ">
                </div>

                <div class="box-body">
                    <table id="stock_table" class="table table-bordered table-striped">
                        <thead>
                        <tr>
                            <th>Stock Code</th>
                            <th>Name</th>
                            <th>Issue Date</th>
                            <th>Prev Close Price</th>
                            <th>Opening Price</th>
                            <th>Type</th>
                            <th>Board</th>
                            <th>Change</th>
                            <th>Details</th>
                        </tr>
                        </thead>
                        <tbody>

                        {% for item in stock %}
                            {% if item.change_extent > 0 %}
                                <tr style="color: red">
                                    <td>{{ item.stock_id }}</td>
                                    <td>{{ item.stock_name }}</td>
                                    <td>{{ item.issuance_time }}</td>
                                    <td>{{ item.closing_price_y }}</td>
                                    <td>{{ item.open_price_t }}</td>
                                    <td>{{ item.stock_type }}</td>
                                    <td>{{ item.block }}</td>
                                    <td>{{ item.change_extent }}</td>
                                    <td style="vertical-align: middle">
                                        <a href="{% url 'tradingSystem:stock_info' item.stock_id %}">detail</a>
                                    </td>
                                </tr>
                            {% else %}
                                <tr style="color: green">
                                    <td>{{ item.stock_id }}</td>
                                    <td>{{ item.stock_name }}</td>
                                    <td>{{ item.issuance_time }}</td>
                                    <td>{{ item.closing_price_y }}</td>
                                    <td>{{ item.open_price_t }}</td>
                                    <td>{{ item.stock_type }}</td>
                                    <td>{{ item.block }}</td>
                                    <td>{{ item.change_extent }}</td>
                                    <td style="vertical-align: middle">
                                        <a href="{% url 'tradingSystem:stock_info' item.stock_id %}">detail</a>
                                    </td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
               <div class="row">

            <div class="col-md-12">
                {#                <div class="box box-solid bg-teal-gradien">#}
                <div class="box box-solid">
                    <div class="box-header">
                        <i class="fa fa-th"></i>

                        <h3 class="box-title">Trending Stocks</h3>

                        <div class="box-tools pull-right">
                            <button type="button" class="btn bg-teal btn-sm" data-widget="collapse"><i
                                    class="fa fa-minus"></i>
                            </button>
                            <button type="button" class="btn bg-teal btn-sm" data-widget="remove"><i
                                    class="fa fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="box-body">
                        <div id="stock-chart" style="height:500px;"></div>
                    </div>
                    <!-- /.box-body -->
                    <div class="box-footer no-border">
                        {% comment %}
                        <div class="row">

                            <div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">
                                <input type="text" class="knob" data-readonly="true" value="20" data-width="60"
                                       data-height="60"
                                       data-fgColor="#39CCCC">

                                <div class="knob-label">Mail-Orders</div>
                            </div>

                            <!-- ./col -->
                            <div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">
                                <input type="text" class="knob" data-readonly="true" value="50" data-width="60"
                                       data-height="60"
                                       data-fgColor="#39CCCC">

                                <div class="knob-label">Online</div>
                            </div>
                            <!-- ./col -->
                            <div class="col-xs-4 text-center">
                                <input type="text" class="knob" data-readonly="true" value="30" data-width="60"
                                       data-height="60"
                                       data-fgColor="#39CCCC">

                                <div class="knob-label">In-Store</div>
                            </div>
                            <!-- ./col -->
                        </div>
                        {% endcomment %}
                        <!-- /.row -->
                    </div>
                    <!-- /.box-footer -->
                </div>
            </div>

            <!-- <div class="col-md-4">            
                <div class="box box-success">
                </div>           
            </div> -->
        </div>
        <div class="row">
        </div>

    </section>
{% endblock %}
{% block script %}
    <script>

        $(function () {
            $(".select2").select2();
        });
        $(function () {
            var table = $('#stock_table').DataTable({
                dom: 'Bfrtip',
                buttons: [],
                "paging": true, 
                "lengthChange": true, 
                "searching": true, 
                "ordering": true, 
                "info": true, 
                "autoWidth": false, 
                "language": {
                    "sProcessing": "being processed...",
                    "sLengthMenu": "The _MENU_ item results are displayed",
                    "sZeroRecords": "No match result",
                    "sInfo": "The results of items from _START_ to _END_ are displayed. _TOTAL_ items are displayed",
                    "sInfoEmpty": "The results of items from 0 to 0 are displayed. 0 items are displayed",
                    "sInfoFiltered": "(Filtered by _MAX_ results)",
                    "sInfoPostFix": "",
                    "sSearch": "Search:",
                    "sUrl": "",
                    "sEmptyTable": "Data in the table is empty",
                    "sLoadingRecords": "Loading...",
                    "sInfoThousands": ",",
                    "oPaginate": {
                        "sFirst": "Home",
                        "sPrevious": "Pre",
                        "sNext": "Next",
                        "sLast": "End"
                    },
                    "oAria": {
                        "sSortAscending": ": ascending order",
                        "sSortDescending": ": descending order"
                    }
                },
                "columnDefs": [{
                    "searchable": false,
                    "orderable": true,
                    "targets": 0
                }],
                "order": [[0, 'asc']]
            });

            $('#stock_table').on('click', 'tr', function (e) {
                if ($(this).hasClass('selected')) {
                    $(this).removeClass('selected');
                } else {
                    table.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                }
            });

            $('.select2').select2();
        });


        $(document).ready(function () {

//            $(".name").click


            /*基于准备好的dom，初始化echarts实例*/
            var myChart = echarts.init(document.getElementById('stock-chart'));

            // 数据意义：开盘(open)，收盘(close)，最低(lowest)，最高(highest)
            var data0 = splitData([['2023-07-31', 4584.819824, 4594.220215, 4573.140137, 4588.959961], ['2023-08-01', 4578.830078, 4584.620117, 4567.529785, 4576.72998], ['2023-08-02', 4550.930176, 4550.930176, 4505.75, 4513.390137], ['2023-08-03', 4494.27002, 4519.490234, 4485.540039, 4501.890137], ['2023-08-04', 4513.959961, 4540.339844, 4474.549805, 4478.029785], ['2023-08-07', 4491.580078, 4519.839844, 4491.149902, 4518.439941], ['2023-08-08', 4498.029785, 4503.310059, 4464.390137, 4499.379883], ['2023-08-09', 4501.569824, 4502.439941, 4461.330078, 4467.709961], ['2023-08-10', 4487.160156, 4527.370117, 4457.919922, 4468.830078], ['2023-08-11', 4450.689941, 4476.22998, 4443.97998, 4464.049805], ['2023-08-14', 4458.129883, 4490.330078, 4453.439941, 4489.720215], ['2023-08-15', 4478.870117, 4478.870117, 4432.189941, 4437.859863], ['2023-08-16', 4433.790039, 4449.950195, 4403.549805, 4404.330078], ['2023-08-17', 4416.319824, 4421.169922, 4364.830078, 4370.359863], ['2023-08-18', 4344.879883, 4381.819824, 4335.310059, 4369.709961], ['2023-08-21', 4380.279785, 4407.549805, 4360.299805, 4399.77002], ['2023-08-22', 4415.330078, 4418.589844, 4382.77002, 4387.549805], ['2023-08-23', 4396.439941, 4443.180176, 4396.439941, 4436.009766], ['2023-08-24', 4455.160156, 4458.299805, 4375.549805, 4376.310059], ['2023-08-25', 4389.379883, 4418.459961, 4356.290039, 4405.709961], ['2023-08-28', 4426.029785, 4439.560059, 4414.97998, 4433.310059], ['2023-08-29', 4432.75, 4500.140137, 4431.680176, 4497.629883], ['2023-08-30', 4500.339844, 4521.649902, 4493.589844, 4514.870117], ['2023-08-31', 4517.009766, 4532.259766, 4507.390137, 4507.660156], ['2023-09-01', 4530.600098, 4541.25, 4501.350098, 4515.77002], ['2023-09-05', 4510.060059, 4514.290039, 4496.009766, 4496.830078], ['2023-09-06', 4490.350098, 4490.350098, 4442.379883, 4465.47998], ['2023-09-07', 4434.549805, 4457.810059, 4430.459961, 4451.140137], ['2023-09-08', 4451.299805, 4473.529785, 4448.379883, 4457.490234], ['2023-09-11', 4480.97998, 4490.77002, 4467.890137, 4487.459961], ['2023-09-12', 4473.27002, 4487.109863, 4456.830078, 4461.899902], ['2023-09-13', 4462.649902, 4479.390137, 4453.52002, 4467.439941], ['2023-09-14', 4487.779785, 4511.990234, 4478.689941, 4505.100098], ['2023-09-15', 4497.97998, 4497.97998, 4447.209961, 4450.319824], ['2023-09-18', 4445.129883, 4466.359863, 4442.109863, 4453.529785], ['2023-09-19', 4445.410156, 4449.850098, 4416.609863, 4443.950195], ['2023-09-20', 4452.810059, 4461.029785, 4401.379883, 4402.200195], ['2023-09-21', 4374.359863, 4375.700195, 4329.169922, 4330.0], ['2023-09-22', 4341.740234, 4357.399902, 4316.490234, 4320.060059], ['2023-09-25', 4310.620117, 4338.509766, 4302.700195, 4337.439941], ['2023-09-26', 4312.879883, 4313.009766, 4265.97998, 4273.529785], ['2023-09-27', 4282.629883, 4292.069824, 4238.629883, 4274.509766], ['2023-09-28', 4269.649902, 4317.27002, 4264.379883, 4299.700195], ['2023-09-29', 4328.180176, 4333.149902, 4274.859863, 4288.049805], ['2023-10-02', 4284.52002, 4300.580078, 4260.209961, 4288.390137], ['2023-10-03', 4269.75, 4281.149902, 4216.450195, 4229.450195], ['2023-10-04', 4233.830078, 4268.5, 4220.47998, 4263.75], ['2023-10-05', 4259.310059, 4267.129883, 4225.910156, 4258.189941], ['2023-10-06', 4234.790039, 4324.100098, 4219.549805, 4308.5], ['2023-10-09', 4289.02002, 4341.72998, 4283.790039, 4335.660156], ['2023-10-10', 4339.75, 4385.459961, 4339.640137, 4358.240234], ['2023-10-11', 4366.589844, 4378.640137, 4345.339844, 4376.950195], ['2023-10-12', 4380.939941, 4385.850098, 4325.430176, 4349.609863], ['2023-10-13', 4360.490234, 4377.100098, 4311.970215, 4327.779785], ['2023-10-16', 4342.370117, 4383.330078, 4342.370117, 4373.629883], ['2023-10-17', 4345.22998, 4393.569824, 4337.540039, 4373.200195], ['2023-10-18', 4357.350098, 4364.200195, 4303.839844, 4314.600098], ['2023-10-19', 4321.359863, 4339.540039, 4269.689941, 4278.0], ['2023-10-20', 4273.850098, 4276.560059, 4223.029785, 4224.160156], ['2023-10-23', 4210.399902, 4255.839844, 4189.220215, 4217.040039], ['2023-10-24', 4235.790039, 4259.379883, 4219.430176, 4247.680176], ['2023-10-25', 4232.419922, 4232.419922, 4181.419922, 4186.77002], ['2023-10-26', 4175.990234, 4183.600098, 4127.899902, 4137.22998], ['2023-10-27', 4152.930176, 4156.700195, 4103.779785, 4117.370117], ['2023-10-30', 4139.390137, 4177.470215, 4132.939941, 4166.819824], ['2023-10-31', 4171.330078, 4195.549805, 4153.120117, 4193.799805], ['2023-11-01', 4201.27002, 4245.640137, 4197.740234, 4237.859863], ['2023-11-02', 4268.259766, 4319.720215, 4268.259766, 4317.779785], ['2023-11-03', 4334.22998, 4373.620117, 4334.22998, 4358.339844], ['2023-11-06', 4364.27002, 4372.209961, 4347.529785, 4365.97998], ['2023-11-07', 4366.209961, 4386.259766, 4355.410156, 4378.379883], ['2023-11-08', 4384.370117, 4391.200195, 4359.759766, 4382.779785], ['2023-11-09', 4391.410156, 4393.399902, 4343.939941, 4347.350098], ['2023-11-10', 4364.149902, 4418.029785, 4353.339844, 4415.240234], ['2023-11-13', 4406.660156, 4421.759766, 4393.819824, 4411.549805], ['2023-11-14', 4458.970215, 4508.669922, 4458.970215, 4495.700195], ['2023-11-15', 4505.299805, 4521.169922, 4495.310059, 4502.879883], ['2023-11-16', 4497.080078, 4511.990234, 4487.830078, 4508.240234], ['2023-11-17', 4509.549805, 4520.120117, 4499.660156, 4514.02002], ['2023-11-20', 4511.700195, 4557.109863, 4510.359863, 4547.379883], ['2023-11-21', 4538.77002, 4542.140137, 4525.509766, 4538.189941], ['2023-11-22', 4553.040039, 4568.430176, 4545.049805, 4556.620117], ['2023-11-24', 4555.839844, 4560.310059, 4552.799805, 4559.339844], ['2023-11-27', 4554.859863, 4560.52002, 4546.319824, 4550.430176], ['2023-11-28', 4545.549805, 4568.140137, 4540.509766, 4554.890137], ['2023-11-29', 4571.839844, 4587.640137, 4547.149902, 4550.580078], ['2023-11-30', 4554.870117, 4569.890137, 4537.240234, 4567.799805], ['2023-12-01', 4559.430176, 4599.390137, 4554.709961, 4594.629883], ['2023-12-04', 4564.370117, 4572.370117, 4546.720215, 4569.779785], ['2023-12-05', 4557.25, 4578.560059, 4551.680176, 4567.180176], ['2023-12-06', 4586.22998, 4590.740234, 4546.5, 4549.339844], ['2023-12-07', 4568.839844, 4590.919922, 4565.220215, 4585.589844], ['2023-12-08', 4576.200195, 4609.22998, 4574.060059, 4604.370117], ['2023-12-11', 4593.390137, 4623.709961, 4593.390137, 4622.439941], ['2023-12-12', 4618.299805, 4643.930176, 4608.089844, 4643.700195], ['2023-12-13', 4646.200195, 4709.689941, 4643.22998, 4707.089844], ['2023-12-14', 4721.040039, 4738.569824, 4694.339844, 4719.549805], ['2023-12-15', 4714.22998, 4725.529785, 4704.689941, 4719.189941], ['2023-12-18', 4725.580078, 4749.52002, 4725.580078, 4740.560059], ['2023-12-19', 4743.720215, 4768.689941, 4743.720215, 4768.370117], ['2023-12-20', 4764.72998, 4778.009766, 4697.819824, 4698.350098], ['2023-12-21', 4724.290039, 4748.709961, 4708.350098, 4746.75], ['2023-12-22', 4753.919922, 4772.939941, 4736.77002, 4754.629883], ['2023-12-26', 4758.859863, 4784.720215, 4758.450195, 4774.75], ['2023-12-27', 4773.450195, 4785.390137, 4768.899902, 4781.580078], ['2023-12-28', 4786.439941, 4793.299805, 4780.97998, 4783.350098], ['2023-12-29', 4782.879883, 4788.430176, 4751.990234, 4769.830078], ['2024-01-02', 4745.200195, 4754.330078, 4722.669922, 4742.830078], ['2024-01-03', 4725.069824, 4729.290039, 4699.709961, 4704.810059], ['2024-01-04', 4697.419922, 4726.779785, 4687.529785, 4688.680176], ['2024-01-05', 4690.569824, 4721.490234, 4682.109863, 4697.240234], ['2024-01-08', 4703.700195, 4764.540039, 4699.819824, 4763.540039], ['2024-01-09', 4741.930176, 4765.470215, 4730.350098, 4756.5], ['2024-01-10', 4759.939941, 4790.799805, 4756.200195, 4783.450195], ['2024-01-11', 4792.129883, 4798.5, 4739.580078, 4780.240234], ['2024-01-12', 4791.180176, 4802.399902, 4768.97998, 4783.830078], ['2024-01-16', 4772.350098, 4782.339844, 4747.120117, 4765.97998], ['2024-01-17', 4739.129883, 4744.22998, 4714.819824, 4739.209961], ['2024-01-18', 4760.100098, 4785.790039, 4740.569824, 4780.939941], ['2024-01-19', 4796.279785, 4842.069824, 4785.870117, 4839.810059], ['2024-01-22', 4853.419922, 4868.410156, 4844.049805, 4850.430176], ['2024-01-23', 4856.799805, 4866.47998, 4844.370117, 4864.600098], ['2024-01-24', 4888.560059, 4903.680176, 4865.939941, 4868.549805], ['2024-01-25', 4886.660156, 4898.149902, 4869.339844, 4894.160156], ['2024-01-26', 4888.910156, 4906.689941, 4881.470215, 4890.970215], ['2024-01-29', 4892.950195, 4929.310059, 4887.399902, 4927.930176], ['2024-01-30', 4925.890137, 4931.089844, 4916.27002, 4924.970215], ['2024-01-31', 4899.189941, 4906.75, 4845.149902, 4845.649902], ['2024-02-01', 4861.109863, 4906.970215, 4853.52002, 4906.189941], ['2024-02-02', 4916.060059, 4975.290039, 4907.990234, 4958.609863], ['2024-02-05', 4957.189941, 4957.189941, 4918.089844, 4942.810059], ['2024-02-06', 4950.160156, 4957.77002, 4934.879883, 4954.22998], ['2024-02-07', 4973.049805, 4999.890137, 4969.049805, 4995.060059], ['2024-02-08', 4995.160156, 5000.399902, 4987.089844, 4997.910156], ['2024-02-09', 5004.169922, 5030.060059, 5000.339844, 5026.609863], ['2024-02-12', 5026.830078, 5048.390137, 5016.830078, 5021.839844], ['2024-02-13', 4967.939941, 4971.299805, 4920.310059, 4953.169922], ['2024-02-14', 4976.439941, 5002.52002, 4956.450195, 5000.620117], ['2024-02-15', 5003.140137, 5032.720215, 4999.439941, 5029.72998], ['2024-02-16', 5031.129883, 5038.700195, 4999.52002, 5005.569824], ['2024-02-20', 4989.319824, 4993.709961, 4955.02002, 4975.509766], ['2024-02-21', 4963.029785, 4983.209961, 4946.0, 4981.799805], ['2024-02-22', 5038.830078, 5094.390137, 5038.830078, 5087.029785], ['2024-02-23', 5100.919922, 5111.060059, 5081.459961, 5088.799805], ['2024-02-26', 5093.0, 5097.660156, 5068.910156, 5069.529785], ['2024-02-27', 5074.600098, 5080.689941, 5057.290039, 5078.180176], ['2024-02-28', 5067.200195, 5077.370117, 5058.350098, 5069.759766], ['2024-02-29', 5085.359863, 5104.990234, 5061.890137, 5096.27002], ['2024-03-01', 5098.509766, 5140.330078, 5094.160156, 5137.080078], ['2024-03-04', 5130.990234, 5149.669922, 5127.180176, 5130.950195], ['2024-03-05', 5110.52002, 5114.540039, 5056.819824, 5078.649902], ['2024-03-06', 5108.029785, 5127.970215, 5092.220215, 5104.759766], ['2024-03-07', 5132.379883, 5165.620117, 5128.209961, 5157.359863], ['2024-03-08', 5164.459961, 5189.259766, 5117.5, 5123.689941], ['2024-03-11', 5111.959961, 5124.660156, 5091.140137, 5117.939941], ['2024-03-12', 5134.299805, 5179.870117, 5114.47998, 5175.27002], ['2024-03-13', 5173.490234, 5179.140137, 5151.879883, 5165.310059], ['2024-03-14', 5175.140137, 5176.850098, 5123.299805, 5150.47998], ['2024-03-15', 5123.310059, 5136.859863, 5104.350098, 5117.089844], ['2024-03-18', 5154.77002, 5175.600098, 5145.470215, 5149.419922], ['2024-03-19', 5139.089844, 5180.310059, 5131.589844, 5178.509766], ['2024-03-20', 5181.689941, 5226.189941, 5171.549805, 5224.620117], ['2024-03-21', 5253.430176, 5261.100098, 5240.660156, 5241.529785], ['2024-03-22', 5242.47998, 5246.089844, 5229.870117, 5234.180176], ['2024-03-25', 5219.52002, 5229.089844, 5216.089844, 5218.189941], ['2024-03-26', 5228.850098, 5235.160156, 5203.419922, 5203.580078], ['2024-03-27', 5226.310059, 5249.259766, 5213.919922, 5248.490234], ['2024-03-28', 5248.029785, 5264.850098, 5245.819824, 5254.350098], ['2024-04-01', 5257.970215, 5263.950195, 5229.200195, 5243.77002], ['2024-04-02', 5204.290039, 5208.339844, 5184.049805, 5205.810059], ['2024-04-03', 5194.370117, 5228.75, 5194.370117, 5211.490234], ['2024-04-04', 5244.049805, 5256.589844, 5146.060059, 5147.209961], ['2024-04-05', 5158.950195, 5222.180176, 5157.209961, 5204.339844], ['2024-04-08', 5211.370117, 5219.569824, 5197.350098, 5202.390137], ['2024-04-09', 5217.029785, 5224.810059, 5160.779785, 5209.910156], ['2024-04-10', 5167.879883, 5178.430176, 5138.700195, 5160.640137], ['2024-04-11', 5172.950195, 5211.779785, 5138.77002, 5199.060059], ['2024-04-12', 5171.509766, 5175.029785, 5107.939941, 5123.410156], ['2024-04-15', 5149.669922, 5168.430176, 5052.470215, 5061.819824], ['2024-04-16', 5064.589844, 5079.839844, 5039.830078, 5051.410156], ['2024-04-17', 5068.970215, 5077.959961, 5007.25, 5022.209961], ['2024-04-18', 5031.52002, 5056.660156, 5001.890137, 5011.120117], ['2024-04-19', 5005.439941, 5019.02002, 4953.560059, 4967.22998], ['2024-04-22', 4987.330078, 5038.839844, 4969.399902, 5010.600098], ['2024-04-23', 5028.850098, 5076.120117, 5027.959961, 5070.549805], ['2024-04-24', 5084.859863, 5089.47998, 5047.02002, 5071.629883], ['2024-04-25', 5019.879883, 5057.75, 4990.580078, 5048.419922], ['2024-04-26', 5084.649902, 5114.620117, 5073.140137, 5099.959961], ['2024-04-29', 5114.129883, 5123.490234, 5088.649902, 5116.169922], ['2024-04-30', 5103.779785, 5110.830078, 5035.310059, 5035.689941], ['2024-05-01', 5029.029785, 5096.120117, 5013.450195, 5018.390137], ['2024-05-02', 5049.319824, 5073.209961, 5011.049805, 5064.200195], ['2024-05-03', 5122.779785, 5139.120117, 5101.220215, 5127.790039], ['2024-05-06', 5142.419922, 5181.0, 5142.419922, 5180.740234], ['2024-05-07', 5187.200195, 5200.22998, 5178.959961, 5187.700195], ['2024-05-08', 5168.97998, 5191.950195, 5165.859863, 5187.669922], ['2024-05-09', 5189.029785, 5215.299805, 5180.410156, 5214.080078], ['2024-05-10', 5225.490234, 5239.660156, 5209.680176, 5222.680176], ['2024-05-13', 5233.080078, 5237.259766, 5211.160156, 5221.419922], ['2024-05-14', 5221.100098, 5250.370117, 5217.97998, 5246.680176], ['2024-05-15', 5263.259766, 5311.759766, 5263.259766, 5308.149902], ['2024-05-16', 5310.069824, 5325.490234, 5296.189941, 5297.100098], ['2024-05-17', 5303.100098, 5305.450195, 5283.589844, 5303.27002], ['2024-05-20', 5305.350098, 5325.319824, 5302.399902, 5308.129883], ['2024-05-21', 5298.689941, 5324.319824, 5297.870117, 5321.410156], ['2024-05-22', 5319.279785, 5323.180176, 5286.009766, 5307.009766], ['2024-05-23', 5340.259766, 5341.879883, 5256.930176, 5267.839844], ['2024-05-24', 5281.450195, 5311.649902, 5278.390137, 5304.720215], ['2024-05-28', 5315.910156, 5315.910156, 5280.890137, 5306.040039], ['2024-05-29', 5278.72998, 5282.27002, 5262.700195, 5266.950195], ['2024-05-30', 5259.77002, 5260.209961, 5222.100098, 5235.47998], ['2024-05-31', 5243.209961, 5280.330078, 5191.680176, 5277.509766], ['2024-06-03', 5297.149902, 5302.109863, 5234.319824, 5283.399902], ['2024-06-04', 5278.240234, 5298.799805, 5257.629883, 5291.339844], ['2024-06-05', 5314.47998, 5354.160156, 5297.640137, 5354.029785], ['2024-06-06', 5357.799805, 5362.350098, 5335.359863, 5352.959961], ['2024-06-07', 5343.810059, 5375.080078, 5331.330078, 5346.990234], ['2024-06-10', 5341.220215, 5365.790039, 5331.52002, 5360.790039], ['2024-06-11', 5353.0, 5375.950195, 5327.25, 5375.319824], ['2024-06-12', 5409.129883, 5447.25, 5409.129883, 5421.029785], ['2024-06-13', 5441.930176, 5441.930176, 5402.509766, 5433.740234], ['2024-06-14', 5424.080078, 5432.390137, 5403.75, 5431.600098], ['2024-06-17', 5431.109863, 5488.5, 5420.399902, 5473.22998], ['2024-06-18', 5476.149902, 5490.379883, 5471.319824, 5487.029785], ['2024-06-20', 5499.990234, 5505.529785, 5455.560059, 5473.169922], ['2024-06-21', 5466.77002, 5478.310059, 5452.029785, 5464.620117], ['2024-06-24', 5459.580078, 5490.660156, 5447.589844, 5447.870117], ['2024-06-25', 5460.72998, 5472.879883, 5446.560059, 5469.299805], ['2024-06-26', 5460.709961, 5483.140137, 5451.870117, 5477.899902], ['2024-06-27', 5473.589844, 5490.810059, 5467.540039, 5482.870117], ['2024-06-28', 5488.47998, 5523.640137, 5451.120117, 5460.47998], ['2024-07-01', 5471.080078, 5479.549805, 5446.529785, 5475.089844], ['2024-07-02', 5461.839844, 5509.689941, 5458.430176, 5509.009766], ['2024-07-03', 5507.439941, 5539.27002, 5507.419922, 5537.02002], ['2024-07-05', 5537.910156, 5570.330078, 5531.629883, 5567.189941], ['2024-07-08', 5572.75, 5583.109863, 5562.509766, 5572.850098], ['2024-07-09', 5584.240234, 5590.75, 5574.569824, 5576.97998], ['2024-07-10', 5591.259766, 5635.390137, 5586.439941, 5633.910156], ['2024-07-11', 5635.209961, 5642.450195, 5576.529785, 5584.540039], ['2024-07-12', 5590.759766, 5655.560059, 5590.439941, 5615.350098], ['2024-07-15', 5638.160156, 5666.939941, 5614.75, 5631.220215], ['2024-07-16', 5644.089844, 5669.669922, 5639.02002, 5667.200195], ['2024-07-17', 5610.069824, 5622.490234, 5584.810059, 5588.27002], ['2024-07-18', 5608.560059, 5614.049805, 5522.810059, 5544.589844], ['2024-07-19', 5543.370117, 5557.5, 5497.040039, 5505.0], ['2024-07-22', 5544.540039, 5570.359863, 5529.040039, 5564.410156], ['2024-07-23', 5565.299805, 5585.339844, 5550.899902, 5555.740234], ['2024-07-24', 5505.839844, 5508.040039, 5419.97998, 5427.129883], ['2024-07-25', 5428.700195, 5491.589844, 5390.950195, 5399.220215], ['2024-07-26', 5433.669922, 5488.319824, 5430.700195, 5459.100098]]);

            //切割数组，把数组中的日期和数据分离，返回数组中的日期和数据
            function splitData(rawData) {
                var categoryData = [];
                var values = [];

                for (var i = 0; i < rawData.length; i++) {
                    //splice 返回每组数组中被删除的第一项，即返回数组中被删除的日期
                    //alert(rawData[i].splice(0, 1)[0]);
                    //categoryData  日期  把返回的日期放到categoryData[]数组中
                    categoryData.push(rawData[i].splice(0, 1)[0]);
                    //alert(categoryData);

                    //数据数组，即数组中除日期外的数据
                    // alert(rawData[i]);
                    values.push(rawData[i])
                }
                return {
                    categoryData: categoryData, //数组中的日期 x轴对应的日期
                    values: values              //数组中的数据 y轴对应的数据
                };
            }

            //计算MA平均线，N日移动平均线=N日收盘价之和/N  dayCount要计算的天数(5,10,20,30)
            function calculateMA(dayCount) {
                var result = [];
                for (var i = 0, len = data0.values.length; i < len; i++) {
                    if (i < dayCount) {
                        result.push('-');
                        //alert(result);
                        continue;   //结束单次循环，即不输出本次结果
                    }
                    var sum = 0;
                    for (var j = 0; j < dayCount; j++) {
                        //收盘价总和
                        sum += data0.values[i - j][1];
                        //alert(sum);
                    }
                    result.push(sum / dayCount);
                    // alert(result);
                }
                return result;
            }


            option = {
                title: {    //标题
                    text: 'S&P 500 INDEX',
                    left: 0
                },
                tooltip: {  //提示框
                    trigger: 'axis',    //触发类型：坐标轴触发
                    axisPointer: {  //坐标轴指示器配置项
                        type: 'cross'   //指示器类型，十字准星
                    }
                },
                legend: {   //图例控件，点击图例控制哪些系列不现实
                    data: ['MA', 'MA5', 'MA10', 'MA20', 'MA30']
                },
                grid: {     //直角坐标系
                    show: true,
                    left: '5%',    //grid组件离容器左侧的距离
                    right: '10%',
                    bottom: '5%',
                    //backgroundColor:'#ccc'
                },
                xAxis: {
                    type: 'category',   //坐标轴类型，类目轴
                    data: data0.categoryData,
                    //scale: true,  //只在数字轴中有效
                    boundaryGap: false,    //刻度作为分割线，标签和数据点会在两个刻度上
                    axisLine: {onZero: false},
                    splitLine: {show: false},   //是否显示坐标轴轴线
                    //splitNumber: 20,    //坐标轴的分割段数，预估值，在类目轴中无效
                    min: 'dataMin', //特殊值，数轴上的最小值作为最小刻度
                    max: 'dataMax'  //特殊值，数轴上的最大值作为最大刻度
                },
                yAxis: {
                    scale: true,    //坐标刻度不强制包含零刻度
                    splitArea: {
                        show: true  //显示分割区域
                    }
                },
                dataZoom: [     //用于区域缩放
                    {
                        filterMode: 'filter',    //当前数据窗口外的数据被过滤掉来达到数据窗口缩放的效果  默认值filter
                        type: 'inside', //内置型数据区域缩放组件
                        start: 50,      //数据窗口范围的起始百分比
                        end: 100        //数据窗口范围的结束百分比
                    },
                    {
                        show: true,
                        type: 'slider', //滑动条型数据区域缩放组件
                        y: '90%',
                        start: 50,
                        end: 100
                    }
                ],
                series: [   //图表类型
                    {
                        name: 'MA',
                        type: 'candlestick',    //K线图
                        data: data0.values,     //y轴对应的数据

                        ////////////////////////图标标注/////////////////////////////

                        markPoint: {    //图表标注
                            label: {    //标注的文本
                                normal: {   //默认不显示标注
                                    show: true,
                                    //position:['20%','30%'],
                                    formatter: function (param) {   //标签内容控制器
                                        return param != null ? Math.round(param.value) : '';
                                    }
                                }
                            },
                            data: [     //标注的数据数组
                                {
                                    name: 'XXpunctuation',
                                    coord: ['2013/5/31', 2300], //指定数据的坐标位置
                                    value: 2300,
                                    itemStyle: {    //图形样式
                                        normal: {color: 'rgb(41,60,85)'}
                                    }
                                },
                                {
                                    name: 'highest value',
                                    type: 'max',    //最大值
                                    valueDim: 'highest'     //在highest维度上的最大值 最高价
                                },
                                {
                                    name: 'lowest value',
                                    type: 'min',
                                    valueDim: 'lowest'  //最低价
                                },
                                {
                                    name: 'average value on close',
                                    type: 'average',
                                    valueDim: 'close'   //收盘价
                                }
                            ],
                            tooltip: {      //提示框
                                formatter: function (param) {
                                    return param.name + '<br>' + (param.data.coord || '');
                                }
                            }
                        },

                        markLine: {
                            symbol: ['none', 'none'],   //标线两端的标记类型
                            data: [
                                [
                                    {
                                        name: 'from lowest to highest',
                                        type: 'min',    //设置该标线为最小值的线
                                        valueDim: 'lowest', //指定在哪个维度上的最小值
                                        symbol: 'circle',
                                        symbolSize: 10, //起点标记的大小
                                        label: {    //normal默认，emphasis高亮
                                            normal: {show: false},  //不显示标签
                                            emphasis: {show: false} //不显示标签
                                        }
                                    },
                                    {
                                        type: 'max',
                                        valueDim: 'highest',
                                        symbol: 'circle',
                                        symbolSize: 10,
                                        label: {
                                            normal: {show: false},
                                            emphasis: {show: false}
                                        }
                                    }
                                ],

                                {
                                    name: 'min line on close',
                                    type: 'min',
                                    valueDim: 'close'
                                },
                                {
                                    name: 'max line on close',
                                    type: 'max',
                                    valueDim: 'close'
                                }
                            ]

                        }

                    },

                    {   //MA5 5天内的收盘价之和/5
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5),
                        smooth: true,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10),
                        smooth: true,
                        lineStyle: {    //标线的样式
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20),
                        smooth: true,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA30',
                        type: 'line',
                        data: calculateMA(30),
                        smooth: true,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },

                ]
            };
            // 使用刚指定的配置项和数据显示图表
            myChart.setOption(option);
            // 设置改变大小重绘窗口
            window.addEventListener("resize", function () {
                myChart.resize();
            });
        });

    </script>
{% endblock %}